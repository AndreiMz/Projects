<div class="form-area">  
          
    <h3 style="margin-bottom: 25px; text-align: center;">Add a new brewery</h3>
    <%= simple_form_for @brewery do |f| %>
      
      <%= f.input :brewery_name  %>
      <%= f.input :brewery_latitude%>
      <%= f.input :brewery_longitude%>
      <%= f.input :brewery_website %>
      <%= f.input :brewery_full_address%>  
      <%= f.button :submit %>
    <%end%>

    <div id="map"></div>


<script>
  
  $('#brewery_brewery_latitude').val('');
  $('#brewery_brewery_longitude').val('');
  $('#brewery_brewery_full_address').val('');
  function initMap() {
    var marker = null;
    var buc_center = {lat:44.427807, lng:26.102521};
    var geocoder = new google.maps.Geocoder;
    var place_id;
    map = new google.maps.Map(document.getElementById('map'), {
      center: buc_center,
      zoom: 14
    });

    var service = new google.maps.places.PlacesService(map);

    google.maps.event.addListener(map, 'click', function(event) {
      if(marker) {
        marker.setMap(null);
      }
     placeMarker(event.latLng);
    });

  function placeMarker(location) {

      marker = new google.maps.Marker({
          position: location, 
          map: map
      });
      

      service.nearbySearch({
          location: location,
          radius: '2',
          type: ['bar', 'restaurant','liquor_store','night_club']
        }, function(my_results, status) {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          place_id = my_results[1].place_id;
          service.getDetails({
            placeId : place_id
          }, function(place,status) {
              
              $('#brewery_brewery_latitude').val(marker.getPosition().lat());
              $('#brewery_brewery_longitude').val(marker.getPosition().lng());
              $('#brewery_brewery_website').val(place.website);
              $('#brewery_brewery_name').val(place.name);
              $('#brewery_brewery_full_address').val(place.formatted_address);
          });
        }
      });

              
              
            

      

  }
    
     
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCVrtzcmMfKSN5Ez8ok6PjJX49c81Uxwec&libraries=places&callback=initMap" async defer></script>
  
</div>